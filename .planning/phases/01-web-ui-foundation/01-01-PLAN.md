---
phase: 01-web-ui-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - requirements.txt
  - .streamlit/config.toml
  - .streamlit/secrets.toml.example
  - lib/__init__.py
  - lib/validators.py
  - .gitignore
autonomous: true

user_setup:
  - service: supabase
    why: "Database access for building data"
    env_vars:
      - name: SUPABASE_HOST
        source: "Supabase Dashboard -> Project Settings -> Database -> Connection string"
      - name: SUPABASE_PASSWORD
        source: "Supabase Dashboard -> Project Settings -> Database (password set at project creation)"
  - service: anthropic
    why: "Claude API for narrative generation"
    env_vars:
      - name: ANTHROPIC_API_KEY
        source: "Anthropic Console -> API Keys -> Create key"

must_haves:
  truths:
    - "Project dependencies can be installed with pip install -r requirements.txt"
    - "BBL validation correctly identifies valid 10-digit BBLs with borough 1-5"
    - "BBL validation rejects invalid formats"
    - "Secrets template shows required configuration without exposing real values"
  artifacts:
    - path: "requirements.txt"
      provides: "Python dependencies"
      contains: "streamlit"
    - path: "lib/validators.py"
      provides: "BBL validation functions"
      exports: ["validate_bbl", "bbl_to_dashed", "bbl_from_dashed"]
    - path: ".streamlit/config.toml"
      provides: "Streamlit configuration"
      contains: "[server]"
    - path: ".streamlit/secrets.toml.example"
      provides: "Secrets template"
      contains: "ANTHROPIC_API_KEY"
  key_links:
    - from: "requirements.txt"
      to: "pip install"
      via: "package installation"
      pattern: "streamlit.*anthropic.*psycopg2"
---

<objective>
Set up the Streamlit project structure with dependencies, configuration, and BBL validation utilities.

Purpose: Establish the foundation for the web UI — dependencies installed, configuration ready, core validation logic in place. This enables parallel development of database and API modules.

Output: Working project skeleton that can be run with `streamlit run app.py` (app.py created in Plan 03).
</objective>

<execution_context>
@C:\Users\minke\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minke\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-web-ui-foundation/01-RESEARCH.md
@CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create project structure and dependencies</name>
  <files>
    requirements.txt
    .streamlit/config.toml
    .streamlit/secrets.toml.example
    lib/__init__.py
    .gitignore
  </files>
  <action>
Create the Streamlit project structure following patterns from 01-RESEARCH.md:

1. **requirements.txt** - Core dependencies:
   ```
   streamlit>=1.28
   anthropic>=0.18
   psycopg2-binary>=2.9
   python-dotenv>=1.0
   pandas>=2.0
   ```

2. **.streamlit/config.toml** - App configuration:
   ```toml
   [server]
   headless = true
   port = 8501

   [theme]
   primaryColor = "#0066cc"
   backgroundColor = "#ffffff"
   secondaryBackgroundColor = "#f0f2f6"
   textColor = "#262730"
   ```

3. **.streamlit/secrets.toml.example** - Template for secrets (user copies to secrets.toml):
   ```toml
   # Copy this file to secrets.toml and fill in real values
   # DO NOT commit secrets.toml to git

   ANTHROPIC_API_KEY = "sk-ant-..."

   [connections.postgresql]
   dialect = "postgresql"
   host = "aws-0-us-west-2.pooler.supabase.com"
   port = "5432"
   database = "postgres"
   username = "postgres.lhtuvtfqjovfuwuxckcw"
   password = "YOUR_PASSWORD_HERE"
   ```

4. **lib/__init__.py** - Empty file to make lib a package

5. **.gitignore** - Add these entries (append if file exists):
   ```
   .streamlit/secrets.toml
   __pycache__/
   *.pyc
   .env
   venv/
   .venv/
   ```

Note: Do NOT include actual database password in secrets.toml.example — use placeholder.
  </action>
  <verify>
    Run: `python -c "import streamlit; import anthropic; import psycopg2; print('OK')"`
    After pip install, this should print "OK"
  </verify>
  <done>
    - requirements.txt exists with all 5 dependencies
    - .streamlit/ directory exists with config.toml and secrets.toml.example
    - lib/ directory exists with __init__.py
    - .gitignore includes .streamlit/secrets.toml
  </done>
</task>

<task type="auto">
  <name>Task 2: Create BBL validation module</name>
  <files>lib/validators.py</files>
  <action>
Create lib/validators.py with BBL validation functions per RESEARCH.md patterns:

```python
"""
BBL validation and format conversion utilities.

BBL (Borough-Block-Lot) is a 10-digit identifier:
- Digit 1: Borough (1=Manhattan, 2=Bronx, 3=Brooklyn, 4=Queens, 5=Staten Island)
- Digits 2-6: Block number (5 digits, zero-padded)
- Digits 7-10: Lot number (4 digits, zero-padded)

Example: 1011190036 = Manhattan, Block 01119, Lot 0036
"""

def validate_bbl(bbl: str) -> bool:
    """
    Validate NYC BBL format.

    Args:
        bbl: BBL string to validate (should be 10 digits)

    Returns:
        True if valid BBL format, False otherwise
    """
    if not bbl or len(bbl) != 10:
        return False

    if not bbl.isdigit():
        return False

    borough = int(bbl[0])
    if borough < 1 or borough > 5:
        return False

    return True


def bbl_to_dashed(bbl: str) -> str:
    """
    Convert 10-digit BBL to dashed format for DOF lookups.

    Args:
        bbl: 10-digit BBL (e.g., "1011190036")

    Returns:
        Dashed format (e.g., "1-01119-0036")

    Raises:
        ValueError: If BBL is not 10 digits
    """
    if len(bbl) != 10:
        raise ValueError(f"BBL must be 10 digits, got {len(bbl)}")
    return f"{bbl[0]}-{bbl[1:6]}-{bbl[6:]}"


def bbl_from_dashed(dashed: str) -> str:
    """
    Convert dashed BBL to 10-digit format.

    Args:
        dashed: Dashed BBL (e.g., "1-01119-0036")

    Returns:
        10-digit format (e.g., "1011190036")
    """
    return dashed.replace("-", "")


def get_borough_name(bbl: str) -> str:
    """
    Get borough name from BBL.

    Args:
        bbl: 10-digit BBL

    Returns:
        Borough name string
    """
    boroughs = {
        "1": "Manhattan",
        "2": "Bronx",
        "3": "Brooklyn",
        "4": "Queens",
        "5": "Staten Island"
    }
    if not bbl:
        return "Unknown"
    return boroughs.get(bbl[0], "Unknown")
```

The module provides:
- validate_bbl(): Core validation (10 digits, valid borough)
- bbl_to_dashed(): Convert to DOF format for browser lookups
- bbl_from_dashed(): Convert from dashed to numeric
- get_borough_name(): Helper for display
  </action>
  <verify>
    Run: `python -c "from lib.validators import validate_bbl, bbl_to_dashed; print(validate_bbl('1011190036'), bbl_to_dashed('1011190036'))"`
    Expected output: `True 1-01119-0036`
  </verify>
  <done>
    - validate_bbl("1011190036") returns True
    - validate_bbl("0011190036") returns False (invalid borough 0)
    - validate_bbl("12345") returns False (wrong length)
    - bbl_to_dashed("1011190036") returns "1-01119-0036"
  </done>
</task>

</tasks>

<verification>
1. Run `pip install -r requirements.txt` - should complete without errors
2. Run `python -c "from lib.validators import validate_bbl; print(validate_bbl('1011190036'))"` - should print True
3. Verify .gitignore contains .streamlit/secrets.toml
4. Verify .streamlit/secrets.toml.example exists with placeholder values (not real credentials)
</verification>

<success_criteria>
- All Python dependencies can be imported after pip install
- BBL validation correctly handles valid/invalid inputs
- Project structure matches RESEARCH.md recommendations
- Secrets template ready for user configuration
</success_criteria>

<output>
After completion, create `.planning/phases/01-web-ui-foundation/01-01-SUMMARY.md`
</output>
